# Plastic Inventory

Полное руководство по установке, настройке и запуску проекта (frontend + backend). Поддерживается локальный запуск и запуск через Docker.

---

## Содержание
- [Требования](#требования)
- [Структура проекта](#структура-проекта)
- [Установка и запуск backend](#установка-и-запуск-backend)
- [Установка и запуск frontend](#установка-и-запуск-frontend)
- [Контейнеризация (Docker)](#контейнеризация-docker)
- [Настройка переменных окружения](#настройка-переменных-окружения)
- [Инициализация базы данных и тестовые данные](#инициализация-базы-данных-и-тестовые-данные)
- [Полезные команды](#полезные-команды)
- [Типовые ошибки](#типовые-ошибки)

---

## Требования
- Python 3.10+
- Node.js (LTS, рекомендуется >=18)
- npm (обычно идет вместе с Node.js)
- Git
- Docker и docker-compose (опционально, для контейнеризации)

---

## Структура проекта
```
plastic-inventory/
├── backend/         # Серверная часть (FastAPI, REST API, база данных, миграции)
│   ├── routers/     # Маршруты API (авторизация, проекты, группы, типы пластика и др.)
│   ├── static/      # Статические файлы (QR-коды)
│   ├── utils/       # Вспомогательные скрипты (генерация QR и др.)
│   └── ...
├── frontend/        # Клиентская часть (React + Vite)
│   ├── src/         # Исходный код приложения
│   └── ...
├── plastic.db       # Файл базы данных SQLite (создается автоматически)
├── docker-compose.yml # Docker Compose для запуска всего стека
├── Dockerfile         # Dockerfile для сборки образа
└── README.md
```

---

## Установка и запуск backend (локально)
1. Перейдите в папку backend:
   ```sh
   cd backend
   ```
2. Создайте и активируйте виртуальное окружение (Windows):
   ```sh
   python -m venv venv
   .\venv\Scripts\activate
   ```
3. Установите зависимости:
   ```sh
   pip install -r requirements.txt
   ```
4. Создайте файл `.env` в папке backend со следующим содержимым (или используйте переменные по умолчанию):
   ```env
   SECRET_KEY=supersecretkey
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=60
   ```
5. Инициализируйте базу данных и тестовые данные (по желанию):
   ```sh
   python init_db.py
   ```
6. Запустите сервер:
   ```sh
   uvicorn main:app --reload
   ```
   Сервер будет доступен по адресу http://127.0.0.1:8000 

---

## Установка и запуск frontend (локально)
1. Перейдите в папку frontend:
   ```sh
   cd frontend
   ```
2. Установите зависимости:
   ```sh
   npm install
   ```
3. Запустите проект в режиме разработки:
   ```sh
   npm run dev
   ```
   Откройте браузер и перейдите по адресу, который появится в терминале (обычно http://localhost:5173)

---

## Контейнеризация (Docker)

Для быстрого запуска всего стека используйте Docker и docker-compose. Это удобно для тестирования и деплоя.

1. Убедитесь, что Docker и docker-compose установлены.
2. В корне проекта выполните:
   ```sh
   docker-compose up --build
   ```
   - Backend будет доступен на http://localhost:8000
   - Frontend — на http://localhost:5173
3. Для остановки контейнеров:
   ```sh
   docker-compose down
   ```

- Все переменные окружения для backend можно задать в файле `backend/.env` (см. пример выше). Если файл не создан, используются значения по умолчанию.
- База данных `plastic.db` будет создана автоматически при первом запуске.

---

## Настройка переменных окружения
- Все переменные для backend указываются в файле `.env` (см. пример выше). Если файл отсутствует, используются значения по умолчанию.
- Для frontend обычно ничего настраивать не требуется, если API backend работает на http://localhost:8000.
- Если адрес backend другой, настройте прокси или измените адреса в файлах API (например, `frontend/src/api/axios.js`).

---

## Инициализация базы данных и тестовые данные
- Для создания таблиц и тестовых данных выполните:
  ```sh
  python init_db.py
  ```
- При запуске через Docker база создается автоматически, если её нет.

---

## Полезные команды
- Активация виртуального окружения (Windows):
  ```sh
  .\venv\Scripts\activate
  ```
- Деактивация:
  ```sh
  deactivate
  ```
- Установка новой зависимости (backend):
  ```sh
  pip install <package>
  pip freeze > requirements.txt
  ```
- Установка новой зависимости (frontend):
  ```sh
  npm install <package>
  ```
- Сборка и запуск через Docker Compose:
  ```sh
  docker-compose up --build
  ```
- Остановка контейнеров:
  ```sh
  docker-compose down
  ```

---

## Типовые ошибки
- **Модуль не найден**: Проверьте, что активировано виртуальное окружение и установлены все зависимости.
- **CORS ошибка**: Убедитесь, что backend разрешает запросы с адреса frontend (см. настройку CORS в `main.py`).
- **Ошибка доступа к базе**: Проверьте права на файл `plastic.db` и путь к нему.
- **Порт занят**: Убедитесь, что порты 8000 (backend) и 5173 (frontend) свободны или измените их в настройках.
- **Проблемы с Docker**: Проверьте, что Docker запущен и нет конфликтов портов.

---

