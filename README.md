# Plastic Inventory

Полное руководство по установке, настройке и запуску проекта (frontend + backend). Поддерживается локальный запуск и запуск через Docker. Также приведены рекомендации по деплою на сервер (хостинг).

---

## Содержание
- [Требования](#требования)
- [Структура проекта](#структура-проекта)
- [Установка и запуск backend](#установка-и-запуск-backend)
- [Установка и запуск frontend](#установка-и-запуск-frontend)
- [Контейнеризация (Docker)](#контейнеризация-docker)
- [Настройка переменных окружения](#настройка-переменных-окружения)
- [Деплой на сервер (хостинг)](#деплой-на-сервер-хостинг)
- [Инициализация базы данных и тестовые данные](#инициализация-базы-данных-и-тестовые-данные)
- [Полезные команды](#полезные-команды)
- [Типовые ошибки](#типовые-ошибки)

---

## Требования
- Python 3.10+
- Node.js (LTS, рекомендуется >=18)
- npm (обычно идет вместе с Node.js)
- Git
- Docker и docker-compose (опционально, для контейнеризации)

---

## Структура проекта
```
plastic-inventory/
├── backend/         # Серверная часть (FastAPI, REST API, база данных, миграции)
│   ├── routers/     # Маршруты API (авторизация, проекты, группы, типы пластика и др.)
│   ├── static/      # Статические файлы (QR-коды)
│   ├── utils/       # Вспомогательные скрипты (генерация QR и др.)
│   └── ...
├── frontend/        # Клиентская часть (React + Vite)
│   ├── src/         # Исходный код приложения
│   └── ...
├── plastic.db       # Файл базы данных SQLite (создается автоматически)
├── docker-compose.yml # Docker Compose для запуска всего стека
├── Dockerfile         # Dockerfile для сборки образа
└── README.md
```

---

## Установка и запуск backend (локально)
1. Перейдите в папку backend:
   ```sh
   cd backend
   ```
2. Создайте и активируйте виртуальное окружение (Windows):
   ```sh
   python -m venv venv
   .\venv\Scripts\activate
   ```
3. Установите зависимости:
   ```sh
   pip install -r requirements.txt
   ```
4. Создайте файл `.env` в папке backend со следующим содержимым (или используйте переменные по умолчанию):
   ```env
   SECRET_KEY=supersecretkey
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=60
   ```
5. Инициализируйте базу данных и тестовые данные (по желанию):
   ```sh
   python init_db.py
   ```
6. Запустите сервер:
   ```sh
   uvicorn main:app --reload
   ```
   Сервер будет доступен по адресу http://127.0.0.1:8000 

---

## Установка и запуск frontend (локально)
1. Перейдите в папку frontend:
   ```sh
   cd frontend
   ```
2. Установите зависимости:
   ```sh
   npm install
   ```
3. Запустите проект в режиме разработки:
   ```sh
   npm run dev
   ```
   Откройте браузер и перейдите по адресу, который появится в терминале (обычно http://localhost:5173)

---

## Контейнеризация (Docker)

Для быстрого запуска всего стека используйте Docker и docker-compose. Это удобно для тестирования и деплоя.

1. Убедитесь, что Docker и docker-compose установлены.
2. В корне проекта выполните:
   ```sh
   docker-compose up --build
   ```
   - Backend будет доступен на http://localhost:8000
   - Frontend — на http://localhost:5173
3. Для остановки контейнеров:
   ```sh
   docker-compose down
   ```

- Все переменные окружения для backend можно задать в файле `backend/.env` (см. пример выше). Если файл не создан, используются значения по умолчанию.
- База данных `plastic.db` будет создана автоматически при первом запуске.

---

## Настройка переменных окружения
- Все переменные для backend указываются в файле `.env` (см. пример выше). Если файл отсутствует, используются значения по умолчанию.
- Для frontend обычно ничего настраивать не требуется, если API backend работает на http://localhost:8000.
- Если адрес backend другой (например, при деплое на сервер), настройте прокси или измените адреса в файлах API (например, `frontend/src/api/axios.js`).
- **Для продакшн/хостинга:**
  - Укажите реальные значения переменных в `.env` или настройте переменные окружения через панель управления хостинга.
  - Проверьте, что переменная `VITE_API_URL` (если используется) или базовый URL в `axios.js` указывает на ваш backend (например, `https://your-backend-domain/api`).

---

## Деплой на сервер (хостинг)

### Backend (FastAPI)
1. Загрузите содержимое папки `backend` на сервер.
2. Установите Python 3.10+ и зависимости (`pip install -r requirements.txt`).
3. Создайте файл `.env` с продакшн-значениями:
   ```env
   SECRET_KEY=your_production_secret
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=60
   # Добавьте другие переменные при необходимости
   ```
4. Запустите сервер через uvicorn/gunicorn или настройте systemd-сервис.
5. Проверьте, что порт (обычно 8000) открыт или используйте проксирование через nginx.

### Frontend (React + Vite)
1. Загрузите содержимое папки `frontend` на сервер.
2. В файле `frontend/src/api/axios.js` измените базовый URL на адрес вашего backend, например:
   ```js
   // ...existing code...
   const API_URL = 'https://your-backend-domain/api';
   // ...existing code...
   ```
   Или используйте переменные окружения Vite (`VITE_API_URL`).
3. Соберите проект:
   ```sh
   npm install
   npm run build
   ```
4. Настройте отдачу статики через nginx или другой веб-сервер. Пример конфига nginx:
   ```nginx
   server {
       listen 80;
       server_name your-frontend-domain;
       root /path/to/frontend/dist;
       index index.html;

       location /api/ {
           proxy_pass http://localhost:8000/api/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }

       location / {
           try_files $uri $uri/ /index.html;
       }
   }
   ```

### Важно
- Если фронт и бекенд на разных доменах/поддоменах — настройте CORS в backend (`main.py`).
- Проверьте, что все переменные окружения заданы корректно.
- Для безопасности используйте HTTPS.

---

## Инициализация базы данных и тестовые данные
- Для создания таблиц и тестовых данных выполните:
  ```sh
  python init_db.py
  ```
- При запуске через Docker база создается автоматически, если её нет.

---

## Полезные команды
- Активация виртуального окружения (Windows):
  ```sh
  .\venv\Scripts\activate
  ```
- Деактивация:
  ```sh
  deactivate
  ```
- Установка новой зависимости (backend):
  ```sh
  pip install <package>
  pip freeze > requirements.txt
  ```
- Установка новой зависимости (frontend):
  ```sh
  npm install <package>
  ```
- Сборка и запуск через Docker Compose:
  ```sh
  docker-compose up --build
  ```
- Остановка контейнеров:
  ```sh
  docker-compose down
  ```

---

## Типовые ошибки
- **Модуль не найден**: Проверьте, что активировано виртуальное окружение и установлены все зависимости.
- **CORS ошибка**: Убедитесь, что backend разрешает запросы с адреса frontend (см. настройку CORS в `main.py`). При деплое на сервер проверьте, что в CORS разрешён домен фронтенда.
- **Ошибка доступа к базе**: Проверьте права на файл `plastic.db` и путь к нему.
- **Порт занят**: Убедитесь, что порты 8000 (backend) и 5173 (frontend) свободны или измените их в настройках/nginx.
- **Проблемы с Docker**: Проверьте, что Docker запущен и нет конфликтов портов.
- **Фронтенд не видит backend**: Проверьте, что адрес API в `axios.js` или переменной окружения совпадает с реальным адресом backend.

---

